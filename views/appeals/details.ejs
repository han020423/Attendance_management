<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <h1><%= title %></h1>
  <p><a href="/appeals">목록으로</a></p>

  <div>
    <p><strong>학생:</strong> <%= appeal.Student ? appeal.Student.name : 'N/A' %> (<%= appeal.Student ? appeal.Student.email : 'N/A' %>)</p>
    <p><strong>강의:</strong> <%= appeal.Attendance.ClassSession.Course.title %> - <%= appeal.Attendance.ClassSession.week %>주차</p>
    <p><strong>기존 출석 상태:</strong> 
      <% const statuses = {0:'미정', 1:'출석', 2:'지각', 3:'결석', 4:'공결'}; %>
      <%= statuses[appeal.Attendance.status] %>
    </p>
    <p><strong>신청일:</strong> <%= new Date(appeal.createdAt).toLocaleString() %></p>
    <p><strong>학생 메시지:</strong> <pre><%= appeal.message %></pre></p>
  </div>

  <hr>

  <% if (user.role === 'INSTRUCTOR' && appeal.status === 'PENDING') { %>
    <h2>처리</h2>
    <form action="/appeals/<%= appeal.id %>?_method=PATCH" method="post">
      <div>
        <label for="new_attendance_status">출석 상태 변경:</label>
        <select name="new_attendance_status" id="new_attendance_status">
          <option value="">-- 변경 안함 --</option>
          <option value="1">출석</option>
          <option value="2">지각</option>
          <option value="3">결석</option>
        </select>
      </div>
      <div>
        <label for="review_comment">코멘트:</label>
        <textarea name="review_comment" id="review_comment" rows="3"></textarea>
      </div>
      <button type="submit" name="status" value="APPROVED">승인</button>
      <button type="submit" name="status" value="REJECTED">반려</button>
    </form>
  <% } else if (appeal.status !== 'PENDING') { %>
    <h2>처리 결과</h2>
    <p><strong>상태:</strong> <%= appeal.status %></p>
    <p><strong>처리자:</strong> <%= appeal.Reviewer ? appeal.Reviewer.name : 'N/A' %></p>
    <p><strong>처리일:</strong> <%= new Date(appeal.updatedAt).toLocaleString() %></p>
    <p><strong>코멘트:</strong> <pre><%= appeal.review_comment %></pre></p>
  <% } %>

</body>
</html>
