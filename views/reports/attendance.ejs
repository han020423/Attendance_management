<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <h1><%= title %></h1>
  <p><a href="/me/dashboard">대시보드로 돌아가기</a></p>

  <form action="/reports/attendance" method="get">
    <label for="course_id">강의 선택:</label>
    <select name="course_id" id="course_id" onchange="this.form.submit()">
      <option value="">-- 강의를 선택하세요 --</option>
      <% courses.forEach(course => { %>
        <option value="<%= course.id %>" <%= locals.selectedCourseId == course.id ? 'selected' : '' %>>
          <%= course.title %>
        </option>
      <% }) %>
    </select>
  </form>

  <% if (reportData) { %>
    <hr>
    <h2>리포트 결과</h2>
    <p><strong>총 학생 수:</strong> <%= reportData.totalStudents %></p>
    <p><strong>총 세션 수:</strong> <%= reportData.totalSessions %></p>
    
    <h3>전체 요약</h3>
    <p>
      출석: <%= reportData.summary.present %> |
      지각: <%= reportData.summary.late %> |
      결석: <%= reportData.summary.absent %> |
      공결: <%= reportData.summary.approved_absence %>
    </p>

    <h3>결석 순위 (위험군)</h3>
    <table>
      <thead>
        <tr>
          <th>이름</th>
          <th>결석 횟수</th>
        </tr>
      </thead>
      <tbody>
        <% reportData.absenteeism.forEach(item => { %>
          <tr>
            <td><%= item.Student ? item.Student.name : 'N/A' %></td>
            <td><%= item.dataValues.absent_count %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>

</body>
</html>
